<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Level UI - Bootstrap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="container-main py-5">
    <div class="row justify-content-center">
        <div class="col-lg-12">

            <div class="game-panel">

                <div class="header-ribbon">
                    Level Select
                </div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="profile-section">
                            <div class="avatar-circle">
                                <!-- Corrected Image Path -->
                                <img th:if="${user.photoUrl != null and user.photoUrl != ''}" th:src="@{'/uploads/' + ${user.photoUrl}}" alt="Foto Profil" class="profile-pic">
                                <!-- Fallback Icon -->
                                <i th:if="${user.photoUrl == null or user.photoUrl == ''}" class="fas fa-user-astronaut" style="font-size: 4rem; color: #fff;"></i>
                            </div>
                            <div class="profile-name">Hi, <span th:text="${user.fullName}"></span></div>
                            <hr style="width: 100%; border-color: rgba(255,255,255,0.3);">
                            <div class="stat-badge">
                                <span><i class="fas fa-school text-warning"></i></span>
                                <span th:text="${user.schoolName}"></span> (<span th:text="${user.kelas}"></span>)
                            </div>
                            <div class="stat-badge">
                                <span><i class="fas fa-envelope text-warning"></i></span>
                                <span th:text="${user.email}"></span> (<span th:text="${user.username}"></span>)
                            </div>
                            <div class="mt-auto w-100">
                                <form th:action="@{/logout}" method="post">
                                    <button type="submit" class="btn-level-action py-2" style="background: #d32f2f; border-bottom-color: #b71c1c;">
                                        <i class="fas fa-sign-out-alt"></i> LOGOUT
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="row g-3">
                            <!-- Loop Level 1 sampai 30 -->
                            <div class="col-4 col-lg-2" th:each="i : ${#numbers.sequence(1, 30)}"
                                 th:with="prevLevelKey='level' + ${i-1}, currentLevelKey='level' + ${i}, isUnlocked=${i == 1 or user.levels.containsKey(prevLevelKey)}">

                                <div class="level-card" th:classappend="${!isUnlocked} ? 'locked' : ''">
                                    <div class="level-stars">
                                        <span th:if="${!isUnlocked}"><i class="fas fa-lock"></i></span>
                                        <span th:if="${isUnlocked}">
                                            <i th:class="${user.levels.containsKey(currentLevelKey)} ? 'fas fa-star' : 'far fa-star'"></i>
                                            <i th:class="${user.levels.containsKey(currentLevelKey)} ? 'fas fa-star' : 'far fa-star'"></i>
                                            <i th:class="${user.levels.containsKey(currentLevelKey)} ? 'fas fa-star' : 'far fa-star'"></i>
                                        </span>
                                    </div>
                                    <div class="level-title" th:text="'LVL ' + ${i}">LVL 1</div>

                                    <a th:if="${isUnlocked}" th:href="@{'/siswa/level/' + ${i}}">
                                        <div class="btn-level-action">PLAY</div>
                                    </a>
                                    <div th:unless="${isUnlocked}" class="btn-level-action">LOCK</div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>